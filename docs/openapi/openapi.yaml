openapi: 3.0.3

info:
  title: Private API - Quiz Management System
  description: |
    # Quiz Management System API

    A comprehensive RESTful API for managing educational quizzes, assessments, and submissions.

    ## Architecture

    This API follows **Domain-Driven Design (DDD)** principles with proper bounded contexts:

    - **Authentication**: User registration, login, session management
    - **Subject**: Educational subject management (Math, Physics, etc.)
    - **Grade**: Grade level management (Grade 10, Grade 11, etc.)
    - **Module**: Quiz/Exam content management with questions and choices
    - **Submission**: Public quiz-taking and answer submission

    ## Authentication

    Protected endpoints require a JWT Bearer token in the Authorization header:

    ```
    Authorization: Bearer <access_token>
    ```

  version: 1.0.0
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.private.arvinpaundra.dev
    description: Production server

security:
  - BearerAuth: []

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Dashboard
    description: Dashboard statistics and analytics (requires authentication)
  - name: Subjects
    description: Subject management (requires authentication)
  - name: Grades
    description: Grade level management (requires authentication)
  - name: Modules
    description: Quiz module management
  - name: Submissions
    description: Quiz submission and management endpoints

paths:
  # ==========================================
  # Authentication Endpoints
  # ==========================================
  /v1/auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Creates a new user account. Email must be unique.
      operationId: register
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: 'john.doe@example.com'
              password: 'SecureP@ssw0rd'
              fullname: 'John Doe'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                meta:
                  code: 201
                  message: user registered successfully
                data: null
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticates a user and returns JWT tokens
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: 'john.doe@example.com'
              password: 'SecureP@ssw0rd'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'
              example:
                meta:
                  code: 200
                  message: login successful
                data:
                  access_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                  refresh_token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
                  token_type: 'Bearer'
                  expires_in: 900
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/me/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Invalidates the current user session
      operationId: logout
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              example:
                meta:
                  code: 200
                  message: logout successful
                data: null
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==========================================
  # Subject Management (Admin)
  # ==========================================
  /v1/subjects:
    get:
      tags:
        - Subjects
      summary: List all subjects
      description: Retrieves all subjects with optional keyword search
      operationId: listSubjects
      parameters:
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200':
          description: Subjects retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Subject'
              example:
                meta:
                  code: 200
                  message: subjects fetched successfully
                data:
                  - id: '550e8400-e29b-41d4-a716-446655440000'
                    name: 'Mathematics'
                    description: 'Advanced mathematics course'
                  - id: '550e8400-e29b-41d4-a716-446655440001'
                    name: 'Physics'
                    description: 'Introduction to physics'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Subjects
      summary: Create a new subject
      description: Creates a new subject with a unique name
      operationId: createSubject
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubjectRequest'
      responses:
        '201':
          description: Subject created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/subjects/{id}:
    get:
      tags:
        - Subjects
      summary: Get subject details
      description: Retrieves detailed information about a specific subject
      operationId: getSubject
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Subject retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Subject'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Subjects
      summary: Update a subject
      description: Updates an existing subject's information
      operationId: updateSubject
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubjectRequest'
      responses:
        '200':
          description: Subject updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Subjects
      summary: Delete a subject
      description: Soft deletes a subject by ID
      operationId: deleteSubject
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Subject deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==========================================
  # Grade Management (Admin)
  # ==========================================
  /v1/grades:
    get:
      tags:
        - Grades
      summary: List all grades
      description: Retrieves a paginated list of grades with optional keyword search
      operationId: listGrades
      parameters:
        - $ref: '#/components/parameters/PageNumber'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200':
          description: Grades retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponseWithPagination'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/Grade'
                          pagination:
                            $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Grades
      summary: Create a new grade
      description: Creates a new grade level with a unique name
      operationId: createGrade
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GradeRequest'
      responses:
        '201':
          description: Grade created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/grades/{id}:
    get:
      tags:
        - Grades
      summary: Get grade details
      description: Retrieves detailed information about a specific grade
      operationId: getGrade
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Grade retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Grade'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      tags:
        - Grades
      summary: Update a grade
      description: Updates an existing grade's information
      operationId: updateGrade
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GradeRequest'
      responses:
        '200':
          description: Grade updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      tags:
        - Grades
      summary: Delete a grade
      description: Soft deletes a grade by ID
      operationId: deleteGrade
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Grade deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==========================================
  # Module Management (Admin)
  # ==========================================
  /v1/modules:
    get:
      tags:
        - Modules
      summary: List all modules (Admin)
      description: Retrieves a paginated list of modules with filtering options
      operationId: listModules
      parameters:
        - $ref: '#/components/parameters/PageNumber'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
        - name: subject_id
          in: query
          schema:
            type: string
            format: uuid
        - name: grade_id
          in: query
          schema:
            type: string
            format: uuid
        - name: type
          in: query
          schema:
            type: string
            enum: [quiz, exam]
      responses:
        '200':
          description: Modules retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponseWithPagination'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/Module'
                          pagination:
                            $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags:
        - Modules
      summary: Create a new module
      description: Creates a new quiz or exam module
      operationId: createModule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModuleRequest'
      responses:
        '201':
          description: Module created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/modules/{module_slug}:
    get:
      tags:
        - Modules
      summary: Get module details (Admin)
      description: Retrieves detailed module information including all questions
      operationId: getModule
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
      responses:
        '200':
          description: Module retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/ModuleDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/modules/{module_slug}/publish:
    patch:
      tags:
        - Modules
      summary: Toggle module publish status
      description: Publishes or unpublishes a module
      operationId: togglePublishModule
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
      responses:
        '200':
          description: Module status toggled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/modules/{module_slug}/questions:
    post:
      tags:
        - Modules
      summary: Add or update questions in module
      description: |
        Adds new questions or updates existing questions in a module.
        - If `id` is provided: updates the existing question
        - If `id` is null/omitted: creates a new question
        When updating, all choices are replaced with the provided ones.
      operationId: addQuestions
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddQuestionsRequest'
      responses:
        '201':
          description: Questions added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/modules/{module_slug}/questions/{question_slug}:
    get:
      tags:
        - Modules
      summary: Get published question (Public)
      description: Retrieves a specific question from a published module
      operationId: getPublishedQuestion
      security: []
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
        - name: question_slug
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Question retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Question'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==========================================
  # Dashboard & Statistics (Admin)
  # ==========================================
  /v1/dashboard/statistics:
    get:
      tags:
        - Dashboard
      summary: Get dashboard statistics
      description: |
        Retrieves aggregated statistics for the authenticated user including:
        - Total modules created by the user
        - Total subjects created by the user
        - Total grades created by the user
        - Total submitted submissions (global count across all modules)
      operationId: getDashboardStatistics
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/DashboardStatistics'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==========================================
  # Submission Management (Admin)
  # ==========================================
  /v1/submissions:
    get:
      tags:
        - Submissions
      summary: Get all submissions grouped by modules (Admin)
      description: |
        Retrieves all submitted submissions grouped by modules with their associated grade and subject.
        Returns module details, total submissions count, and list of students who completed each module.
        Only returns submissions with status "submitted".
      operationId: getAllSubmissions
      parameters:
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200':
          description: Submissions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/ModuleSubmissionGroup'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==========================================
  # Quiz Submission (Public)
  # ==========================================
  /v1/modules/{module_slug}/submissions:
    post:
      tags:
        - Submissions
      summary: Start a new quiz submission
      description: Creates a new submission for a student to take the quiz
      operationId: startSubmission
      security: []
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StartSubmissionRequest'
      responses:
        '201':
          description: Submission started successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/StartSubmissionResponse'
              example:
                meta:
                  code: 201
                  message: submission started successfully
                data:
                  code: 'A1B2C3D4E5F6G7H8'
                  status: 'in_progress'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/modules/{module_slug}/submissions/{submission_code}/answers:
    post:
      tags:
        - Submissions
      summary: Submit an answer to a question
      description: Submits a student's answer for a specific question
      operationId: submitAnswer
      security: []
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
        - $ref: '#/components/parameters/SubmissionCode'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitAnswerRequest'
      responses:
        '200':
          description: Answer submitted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SubmitAnswerResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /v1/modules/{module_slug}/submissions/{submission_code}/finalize:
    patch:
      tags:
        - Submissions
      summary: Finalize a quiz submission
      description: Finalizes a quiz submission and calculates the final score
      operationId: finalizeSubmission
      security: []
      parameters:
        - $ref: '#/components/parameters/ModuleSlug'
        - $ref: '#/components/parameters/SubmissionCode'
      responses:
        '200':
          description: Submission finalized successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FinalizeSubmissionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint

  parameters:
    ModuleSlug:
      name: module_slug
      in: path
      required: true
      description: Slug of the module
      schema:
        type: string
        example: 'introduction-to-algebra'

    SubmissionCode:
      name: submission_code
      in: path
      required: true
      description: Unique submission code
      schema:
        type: string
        example: 'A1B2C3D4E5F6G7H8'

    PageNumber:
      name: page
      in: query
      description: Page number for pagination
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1

    PageSize:
      name: per_page
      in: query
      description: Number of items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
        example: 10

    Keyword:
      name: keyword
      in: query
      description: Search keyword
      schema:
        type: string
        example: 'math'

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationErrorResponse'
          example:
            meta:
              code: 400
              message: invalid request body
            data: null
            errors:
              email: email is required

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            meta:
              code: 401
              message: unauthorized
            data: null

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            meta:
              code: 403
              message: forbidden
            data: null

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            meta:
              code: 404
              message: resource not found
            data: null

    Conflict:
      description: Resource conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            meta:
              code: 409
              message: resource already exists
            data: null

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            meta:
              code: 500
              message: internal server error
            data: null

  schemas:
    # ==========================================
    # Common Schemas
    # ==========================================
    Meta:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: operation successful
      required:
        - code
        - message

    MetaWithPagination:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: operation successful
        pagination:
          $ref: '#/components/schemas/Pagination'
      required:
        - code
        - message
        - pagination

    SuccessResponse:
      type: object
      properties:
        meta:
          $ref: '#/components/schemas/Meta'
        data:
          type: object
          nullable: true
          description: Response data varies by endpoint
      required:
        - meta
        - data

    SuccessResponseWithPagination:
      type: object
      properties:
        meta:
          $ref: '#/components/schemas/MetaWithPagination'
        data:
          type: object
          nullable: true
          description: Response data varies by endpoint
      required:
        - meta
        - data

    ErrorResponse:
      type: object
      properties:
        meta:
          $ref: '#/components/schemas/Meta'
        data:
          type: object
          nullable: true
      required:
        - meta
        - data

    ValidationErrorResponse:
      type: object
      properties:
        meta:
          $ref: '#/components/schemas/Meta'
        data:
          type: object
          nullable: true
        errors:
          type: object
          additionalProperties:
            type: string
          example:
            email: email is required
            password: password must be at least 8 characters
      required:
        - meta
        - data

    Pagination:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
          example: 1
        per_page:
          type: integer
          minimum: 1
          maximum: 100
          example: 10
        total:
          type: integer
          example: 100
        total_pages:
          type: integer
          example: 10
      required:
        - page
        - per_page
        - total
        - total_pages

    # ==========================================
    # Authentication Schemas
    # ==========================================
    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          maxLength: 50
          example: 'john.doe@example.com'
          description: User email address
        password:
          type: string
          minLength: 8
          format: password
          example: 'SecureP@ssw0rd'
          description: User password (minimum 8 characters)
        fullname:
          type: string
          minLength: 3
          maxLength: 100
          example: 'John Doe'
          description: User full name
      required:
        - email
        - password
        - fullname

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: 'john.doe@example.com'
          description: User email address
        password:
          type: string
          format: password
          example: 'SecureP@ssw0rd'
          description: User password
      required:
        - email
        - password

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
        refresh_token:
          type: string
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
        token_type:
          type: string
          example: 'Bearer'
        expires_in:
          type: integer
          example: 900
          description: Token expiration in seconds
      required:
        - access_token
        - refresh_token
        - token_type
        - expires_in

    RefreshTokenRequest:
      type: object
      properties:
        refresh_token:
          type: string
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
      required:
        - refresh_token

    RefreshTokenResponse:
      type: object
      properties:
        access_token:
          type: string
          example: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
        token_type:
          type: string
          example: 'Bearer'
        expires_in:
          type: integer
          example: 900
      required:
        - access_token
        - token_type
        - expires_in

    AuthenticatedUser:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        name:
          type: string
          example: 'John Doe'
        email:
          type: string
          format: email
          example: 'john.doe@example.com'
        username:
          type: string
          example: 'johndoe'
      required:
        - id
        - name
        - email
        - username

    # ==========================================
    # Subject Schemas
    # ==========================================
    Subject:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        name:
          type: string
          example: 'Mathematics'
        description:
          type: string
          nullable: true
          example: 'Advanced mathematics course'
      required:
        - id
        - name

    SubjectRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
          example: 'Mathematics'
          description: Subject name
        description:
          type: string
          nullable: true
          example: 'Advanced mathematics course'
          description: Optional subject description
      required:
        - name

    # ==========================================
    # Grade Schemas
    # ==========================================
    Grade:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        name:
          type: string
          example: 'Grade 10'
        created_by:
          type: string
          example: 'John Doe'
        created_at:
          type: string
          format: date-time
          example: '2026-01-01T10:00:00Z'
        updated_at:
          type: string
          format: date-time
          example: '2026-01-01T10:00:00Z'
      required:
        - id
        - name
        - created_by
        - created_at
        - updated_at

    GradeRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
          example: 'Grade 10'
      required:
        - name

    # ==========================================
    # Module Schemas
    # ==========================================
    Module:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        title:
          type: string
          example: 'Introduction to Algebra'
        slug:
          type: string
          example: 'introduction-to-algebra'
        description:
          type: string
          nullable: true
          example: 'Basic concepts of algebra'
        type:
          type: string
          enum: [quiz, exam]
          example: 'quiz'
        is_published:
          type: boolean
          example: true
        subject_name:
          type: string
          example: 'Mathematics'
        grade_name:
          type: string
          example: 'Grade 10'
      required:
        - id
        - title
        - slug
        - type
        - is_published

    ModuleDetail:
      allOf:
        - $ref: '#/components/schemas/Module'
        - type: object
          properties:
            questions:
              type: array
              items:
                $ref: '#/components/schemas/Question'

    ModuleRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 3
          maxLength: 200
          example: 'Introduction to Algebra'
        description:
          type: string
          nullable: true
          maxLength: 1000
          example: 'Basic concepts of algebra'
        type:
          type: string
          enum: [quiz, exam]
          example: 'quiz'
        subject_id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        grade_id:
          type: string
          format: uuid
          example: '660e8400-e29b-41d4-a716-446655440000'
      required:
        - title
        - type
        - subject_id
        - grade_id

    Question:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        content:
          type: string
          example: 'What is the capital of France?'
        slug:
          type: string
          example: 'question-1'
        choices:
          type: array
          items:
            $ref: '#/components/schemas/Choice'
      required:
        - id
        - content
        - slug
        - choices

    Choice:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        slug:
          type: string
          example: 'choice-a'
        content:
          type: string
          example: 'Paris'
      required:
        - id
        - slug
        - content

    AddQuestionsRequest:
      type: object
      properties:
        questions:
          type: array
          minItems: 1
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
                nullable: true
                description: 'Question ID - provide to update existing question, omit to create new'
                example: '550e8400-e29b-41d4-a716-446655440000'
              content:
                type: string
                minLength: 10
                maxLength: 1000
                example: 'What is the capital of France?'
              choices:
                type: array
                minItems: 2
                maxItems: 4
                items:
                  type: object
                  properties:
                    content:
                      type: string
                      minLength: 1
                      maxLength: 500
                      example: 'Paris'
                    is_correct_answer:
                      type: boolean
                      description: 'Exactly one choice must be marked as correct'
                      example: true
                  required:
                    - content
                    - is_correct_answer
            required:
              - content
              - choices
      required:
        - questions
      example:
        questions:
          - id: null
            content: 'What is 2 + 2?'
            choices:
              - content: '3'
                is_correct_answer: false
              - content: '4'
                is_correct_answer: true
          - id: '550e8400-e29b-41d4-a716-446655440000'
            content: 'Updated: What is the capital of France?'
            choices:
              - content: 'London'
                is_correct_answer: false
              - content: 'Paris'
                is_correct_answer: true

    # ==========================================
    # Submission Schemas
    # ==========================================
    Submission:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        module_id:
          type: string
          format: uuid
          example: '660e8400-e29b-41d4-a716-446655440000'
        code:
          type: string
          example: 'A1B2C3D4E5F6G7H8'
        student_name:
          type: string
          example: 'John Doe'
        status:
          type: string
          enum: [in_progress, submitted, canceled]
          example: 'in_progress'
        total_questions:
          type: integer
          example: 10
        submitted_at:
          type: string
          format: date-time
          nullable: true
          example: '2026-01-01T10:30:00Z'
      required:
        - id
        - module_id
        - code
        - student_name
        - status
        - total_questions

    StartSubmissionRequest:
      type: object
      properties:
        student_name:
          type: string
          minLength: 3
          maxLength: 100
          example: 'John Doe'
      required:
        - student_name

    StartSubmissionResponse:
      type: object
      properties:
        code:
          type: string
          example: 'A1B2C3D4E5F6G7H8'
        status:
          type: string
          enum: [in_progress, submitted, canceled]
          example: 'in_progress'
      required:
        - code
        - status

    SubmitAnswerRequest:
      type: object
      properties:
        question_slug:
          type: string
          example: 'question-1'
        choice_slug:
          type: string
          example: 'choice-a'
      required:
        - question_slug
        - choice_slug

    SubmitAnswerResponse:
      type: object
      properties:
        is_correct:
          type: boolean
          example: true
        answer:
          type: string
          example: 'Paris'
        next_question_slug:
          type: string
          nullable: true
          example: 'question-2'
      required:
        - is_correct
        - answer

    FinalizeSubmissionResponse:
      type: object
      properties:
        student_name:
          type: string
          example: 'John Doe'
        score:
          type: integer
          minimum: 0
          example: 8
        total:
          type: integer
          minimum: 0
          example: 10
        status:
          type: string
          enum: [submitted]
          example: 'submitted'
      required:
        - student_name
        - score
        - total
        - status

    ModuleSubmissionGroup:
      type: object
      properties:
        module:
          $ref: '#/components/schemas/ModuleWithRelations'
        total_submissions:
          type: integer
          description: Total number of submitted submissions for this module
          example: 15
        submissions:
          type: array
          description: List of students who submitted the module
          items:
            $ref: '#/components/schemas/SubmissionSummary'
      required:
        - module
        - total_submissions
        - submissions

    ModuleWithRelations:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        title:
          type: string
          example: 'Introduction to Algebra'
        slug:
          type: string
          example: 'introduction-to-algebra'
        grade:
          $ref: '#/components/schemas/GradeInfo'
        subject:
          $ref: '#/components/schemas/SubjectInfo'
      required:
        - id
        - title
        - slug
        - grade
        - subject

    GradeInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        name:
          type: string
          example: 'Grade 10'
      required:
        - id
        - name

    SubjectInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: '550e8400-e29b-41d4-a716-446655440000'
        name:
          type: string
          example: 'Mathematics'
      required:
        - id
        - name

    SubmissionSummary:
      type: object
      properties:
        student_name:
          type: string
          description: Name of the student who submitted
          example: 'John Doe'
        score:
          type: number
          format: float
          description: Score as a decimal between 0.0 and 1.0 (correct answers / total questions)
          minimum: 0.0
          maximum: 1.0
          example: 0.85
        submitted_at:
          type: string
          description: Submission timestamp in format YYYY-MM-DD HH:MM:SS
          example: '2026-01-02 10:30:45'
      required:
        - student_name
        - score
        - submitted_at

    # ==========================================
    # Dashboard Schemas
    # ==========================================
    DashboardStatistics:
      type: object
      properties:
        user_fullname:
          type: string
          description: Full name of the authenticated user
          example: 'John Doe'
        total_modules:
          type: integer
          description: Total number of modules created by the authenticated user
          example: 15
        total_subjects:
          type: integer
          description: Total number of subjects created by the authenticated user
          example: 5
        total_grades:
          type: integer
          description: Total number of grades created by the authenticated user
          example: 8
        total_submitted_submissions:
          type: integer
          description: Total number of submitted submissions across all modules (global count)
          example: 127
      required:
        - user_fullname
        - total_modules
        - total_subjects
        - total_grades
        - total_submitted_submissions
